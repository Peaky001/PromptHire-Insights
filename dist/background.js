/*! For license information please see background.js.LICENSE.txt */
(()=>{function n(){var o,t,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function i(n,r,a,c){var i=r&&r.prototype instanceof l?r:l,u=Object.create(i.prototype);return e(u,"_invoke",function(n,e,r){var a,c,i,l=0,u=r||[],d=!1,p={p:0,n:0,v:o,a:f,f:f.bind(o,4),d:function(n,e){return a=n,c=0,i=o,p.n=e,s}};function f(n,e){for(c=n,i=e,t=0;!d&&l&&!r&&t<u.length;t++){var r,a=u[t],f=p.p,h=a[2];n>3?(r=h===e)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=o):a[0]<=f&&((r=n<2&&f<a[1])?(c=0,p.v=e,p.n=a[1]):f<h&&(r=n<3||a[0]>e||e>h)&&(a[4]=n,a[5]=e,p.n=h,c=0))}if(r||n>1)return s;throw d=!0,e}return function(r,u,h){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,h),c=u,i=h;(t=c<2?o:i)||!d;){a||(c?c<3?(c>1&&(p.n=-1),f(c,i)):p.n=i:p.v=i);try{if(l=2,a){if(c||(r="next"),t=a[r]){if(!(t=t.call(a,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),c=1);a=o}else if((t=(d=p.n<0)?i:n.call(e,p))!==s)break}catch(n){a=o,c=1,i=n}finally{l=1}}return{value:t,done:d}}}(n,a,c),!0),u}var s={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var p=[][a]?t(t([][a]())):(e(t={},a,function(){return this}),t),f=d.prototype=l.prototype=Object.create(p);function h(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,d):(n.__proto__=d,e(n,c,"GeneratorFunction")),n.prototype=Object.create(f),n}return u.prototype=d,e(f,"constructor",d),e(d,"constructor",u),u.displayName="GeneratorFunction",e(d,c,"GeneratorFunction"),e(f),e(f,c,"Generator"),e(f,a,function(){return this}),e(f,"toString",function(){return"[object Generator]"}),(n=function(){return{w:i,m:h}})()}function e(n,o,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(n){a=0}e=function(n,o,t,r){function c(o,t){e(n,o,function(n){return this._invoke(o,t,n)})}o?a?a(n,o,{value:t,enumerable:!r,configurable:!r,writable:!r}):n[o]=t:(c("next",0),c("throw",1),c("return",2))},e(n,o,t,r)}function o(n,e,o,t,r,a,c){try{var i=n[a](c),s=i.value}catch(n){return void o(n)}i.done?e(s):Promise.resolve(s).then(t,r)}function t(n){return function(){var e=this,t=arguments;return new Promise(function(r,a){var c=n.apply(e,t);function i(n){o(c,r,a,i,s,"next",n)}function s(n){o(c,r,a,i,s,"throw",n)}i(void 0)})}}var r=75,a={profileCount:0,windowStart:Date.now(),isCooldown:!1,cooldownEnd:null};function c(){chrome.storage.local.set({rateLimitState:a},function(){console.log("Rate limit state saved:",a)})}function i(){return!(!a.isCooldown||Date.now()>=a.cooldownEnd&&(a.isCooldown=!1,a.cooldownEnd=null,c(),1))}chrome.storage.local.get(["rateLimitState"],function(n){n.rateLimitState&&(a=n.rateLimitState,console.log("Loaded rate limit state:",a))}),chrome.runtime.onMessage.addListener(function(n,e,o){"openPopup"===n.action&&(chrome.action.openPopup(),o({success:!0}))}),chrome.runtime.onInstalled.addListener(function(){console.log("LinkedIn Profile Scraper extension installed")}),chrome.runtime.onSuspend.addListener(function(){console.log("Extension is being suspended, clearing job selection"),chrome.storage.sync.remove(["selectedJobOpening"],function(){console.log("Job selection cleared on extension suspend")})}),chrome.management.onDisabled.addListener(function(n){n.id===chrome.runtime.id&&(console.log("Extension is being disabled, clearing job selection"),chrome.storage.sync.remove(["selectedJobOpening"],function(){console.log("Job selection cleared on extension disable")}))}),chrome.runtime.onMessage.addListener(function(n,e,o){if("scrapeProfile"===n.action){var t=(h=Date.now(),w=3e5,i()?{allowed:!1,reason:"cooldown",cooldownEnd:a.cooldownEnd}:(h-a.windowStart>=w&&(a.profileCount=0,a.windowStart=h,c()),a.profileCount>=r?(a.isCooldown=!0,a.cooldownEnd=h+3e5,c(),{allowed:!1,reason:"limit_reached",cooldownEnd:a.cooldownEnd}):{allowed:!0,remaining:r-a.profileCount,windowReset:a.windowStart+w}));if(!t.allowed){if("cooldown"===t.reason){var s=Math.ceil((t.cooldownEnd-Date.now())/1e3);o({success:!1,error:"Rate limit exceeded. Please wait ".concat(s," seconds before scraping again."),rateLimit:{status:"cooldown",cooldownRemaining:s,cooldownEnd:t.cooldownEnd}})}else if("limit_reached"===t.reason){var l=Math.ceil((t.cooldownEnd-Date.now())/1e3);o({success:!1,error:"Rate limit reached (".concat(r," profiles in ").concat(5," minutes). Please wait ").concat(l," seconds before scraping again."),rateLimit:{status:"cooldown",cooldownRemaining:l,cooldownEnd:t.cooldownEnd}})}return!0}return chrome.tabs.query({active:!0,currentWindow:!0},function(e){e[0]?chrome.tabs.sendMessage(e[0].id,n,function(n){chrome.runtime.lastError?o({success:!1,error:"Content script not available. Please refresh the LinkedIn page."}):(n.success&&(a.profileCount++,c(),console.log("Profile count incremented: ".concat(a.profileCount,"/").concat(r))),o(n))}):o({success:!1,error:"No active tab found"})}),!0}var h,w;if("getRateLimitStatus"===n.action){var g=function(){var n=Date.now(),e=3e5;if(i())return{status:"cooldown",cooldownRemaining:Math.ceil((a.cooldownEnd-n)/1e3),cooldownEnd:a.cooldownEnd};n-a.windowStart>=e&&(a.profileCount=0,a.windowStart=n,c());var o=a.windowStart+e,t=Math.max(0,Math.ceil((o-n)/1e3));return{status:"active",profileCount:a.profileCount,maxProfiles:r,remaining:r-a.profileCount,windowRemaining:t,windowReset:o}}();return o({success:!0,data:g}),!0}return"sendToAPI"===n.action?(function(n,e){return f.apply(this,arguments)}(n.data,n.apiUrl).then(function(n){return o({success:!0,response:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):"fetchOrganizations"===n.action?(function(){return u.apply(this,arguments)}().then(function(n){return o({success:!0,data:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):"fetchJobOpenings"===n.action?(function(){return d.apply(this,arguments)}(n.organizationId).then(function(n){return o({success:!0,data:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):"sendApplicant"===n.action?(function(n){return p.apply(this,arguments)}(n.data).then(function(n){return o({success:!0,response:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):void 0});var s="https://prompthire.org/api",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjhkZjdlYjNkNDQ1NWJlNTM5ZWVhMDdiIiwidXNlcl9uYW1lIjoicGhsaW5rZWRpbiIsInVzZXJfZW1haWwiOiJzaHJleWFzaEBwcm9tcHRoaXJlLmFpIiwib3JnX2lkcyI6WyI2NzNmNjU0NzExZmJlN2U1ZWQxZjM5MmUiXSwiZXhwIjoxNzYwNzczNDUyfQ.lCZEYRd0BNdLz8d96vwJHf7ZLEAUbAdSt6XOMgPGTnY";function u(){return(u=t(n().m(function e(){var o,t,r,a;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,console.log("Fetching organizations from:","".concat(s,"/organisations?page_size=100")),n.n=1,fetch("".concat(s,"/organisations?page_size=100"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)}});case 1:if(o=n.v,console.log("Organizations response status:",o.status),o.ok){n.n=3;break}return n.n=2,o.text();case 2:throw t=n.v,console.error("Organizations API error:",t),new Error("Failed to fetch organizations: ".concat(o.status," ").concat(o.statusText," - ").concat(t));case 3:return n.n=4,o.json();case 4:return r=n.v,console.log("Organizations result:",r),n.a(2,r);case 5:throw n.p=5,a=n.v,console.error("Fetch organizations error:",a),a;case 6:return n.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function d(){return d=t(n().m(function e(){var o,t,r,a,c,i,u=arguments;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:if(o=u.length>0&&void 0!==u[0]?u[0]:null,n.p=1,o){n.n=2;break}throw new Error("Organization ID is required to fetch job openings");case 2:return t="".concat(s,"/jobopening_summary?org_id=").concat(o),console.log("Fetching job openings from:",t),n.n=3,fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)}});case 3:if(r=n.v,console.log("Job openings response status:",r.status),r.ok){n.n=5;break}return n.n=4,r.text();case 4:throw a=n.v,console.error("Job openings API error:",a),new Error("Failed to fetch job openings: ".concat(r.status," ").concat(r.statusText," - ").concat(a));case 5:return n.n=6,r.json();case 6:return c=n.v,console.log("Job openings result:",c),n.a(2,c);case 7:throw n.p=7,i=n.v,console.error("Fetch job openings error:",i),i;case 8:return n.a(2)}},e,null,[[1,7]])})),d.apply(this,arguments)}function p(){return(p=t(n().m(function e(o){var t,r,a,c;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,console.log("Sending applicant to:","".concat(s,"/applicants")),console.log("Applicant data:",o),n.n=1,fetch("".concat(s,"/applicants"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify(o)});case 1:if(t=n.v,console.log("Send applicant response status:",t.status),t.ok){n.n=3;break}return n.n=2,t.text();case 2:throw r=n.v,console.error("Send applicant API error:",r),new Error("Failed to send applicant: ".concat(t.status," ").concat(t.statusText," - ").concat(r));case 3:return n.n=4,t.json();case 4:return a=n.v,console.log("Send applicant result:",a),n.a(2,a);case 5:throw n.p=5,c=n.v,console.error("Send applicant error:",c),c;case 6:return n.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function f(){return(f=t(n().m(function e(o,t){var r,a,c;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,t){n.n=1;break}throw new Error("API URL is required");case 1:return n.n=2,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileData:o,timestamp:(new Date).toISOString(),source:"linkedin-scraper-extension"})});case 2:if((r=n.v).ok){n.n=3;break}throw new Error("API call failed with status: ".concat(r.status));case 3:return n.n=4,r.json();case 4:return a=n.v,n.a(2,a);case 5:throw n.p=5,c=n.v,console.error("API call error:",c),c;case 6:return n.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}chrome.tabs.onActivated.addListener(function(){var e=t(n().m(function e(o){var t,r;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,chrome.tabs.get(o.tabId);case 1:(t=n.v).url&&(t.url.includes("linkedin.com/in/")||t.url.includes("www.linkedin.com/in/"))&&chrome.action.enable(o.tabId),n.n=3;break;case 2:n.p=2,r=n.v,console.error("Error checking tab:",r);case 3:return n.a(2)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}()),console.log("LinkedIn Profile Scraper background script loaded")})();