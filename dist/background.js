/*! For license information please see background.js.LICENSE.txt */
(()=>{function n(){var o,t,r="function"==typeof Symbol?Symbol:{},c=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(n,r,c,a){var i=r&&r.prototype instanceof l?r:l,u=Object.create(i.prototype);return e(u,"_invoke",function(n,e,r){var c,a,i,l=0,u=r||[],d=!1,p={p:0,n:0,v:o,a:f,f:f.bind(o,4),d:function(n,e){return c=n,a=0,i=o,p.n=e,s}};function f(n,e){for(a=n,i=e,t=0;!d&&l&&!r&&t<u.length;t++){var r,c=u[t],f=p.p,h=c[2];n>3?(r=h===e)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=o):c[0]<=f&&((r=n<2&&f<c[1])?(a=0,p.v=e,p.n=c[1]):f<h&&(r=n<3||c[0]>e||e>h)&&(c[4]=n,c[5]=e,p.n=h,a=0))}if(r||n>1)return s;throw d=!0,e}return function(r,u,h){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,h),a=u,i=h;(t=a<2?o:i)||!d;){c||(a?a<3?(a>1&&(p.n=-1),f(a,i)):p.n=i:p.v=i);try{if(l=2,c){if(a||(r="next"),t=c[r]){if(!(t=t.call(c,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,a<2&&(a=0)}else 1===a&&(t=c.return)&&t.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),a=1);c=o}else if((t=(d=p.n<0)?i:n.call(e,p))!==s)break}catch(n){c=o,a=1,i=n}finally{l=1}}return{value:t,done:d}}}(n,c,a),!0),u}var s={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var p=[][c]?t(t([][c]())):(e(t={},c,function(){return this}),t),f=d.prototype=l.prototype=Object.create(p);function h(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,d):(n.__proto__=d,e(n,a,"GeneratorFunction")),n.prototype=Object.create(f),n}return u.prototype=d,e(f,"constructor",d),e(d,"constructor",u),u.displayName="GeneratorFunction",e(d,a,"GeneratorFunction"),e(f),e(f,a,"Generator"),e(f,c,function(){return this}),e(f,"toString",function(){return"[object Generator]"}),(n=function(){return{w:i,m:h}})()}function e(n,o,t,r){var c=Object.defineProperty;try{c({},"",{})}catch(n){c=0}e=function(n,o,t,r){function a(o,t){e(n,o,function(n){return this._invoke(o,t,n)})}o?c?c(n,o,{value:t,enumerable:!r,configurable:!r,writable:!r}):n[o]=t:(a("next",0),a("throw",1),a("return",2))},e(n,o,t,r)}function o(n,e,o,t,r,c,a){try{var i=n[c](a),s=i.value}catch(n){return void o(n)}i.done?e(s):Promise.resolve(s).then(t,r)}function t(n){return function(){var e=this,t=arguments;return new Promise(function(r,c){var a=n.apply(e,t);function i(n){o(a,r,c,i,s,"next",n)}function s(n){o(a,r,c,i,s,"throw",n)}i(void 0)})}}var r=75,c={profileCount:0,windowStart:Date.now(),isCooldown:!1,cooldownEnd:null};function a(){chrome.storage.local.set({rateLimitState:c},function(){console.log("Rate limit state saved:",c)})}function i(){return!(!c.isCooldown||Date.now()>=c.cooldownEnd&&(c.isCooldown=!1,c.cooldownEnd=null,a(),1))}chrome.storage.local.get(["rateLimitState"],function(n){n.rateLimitState&&(c=n.rateLimitState,console.log("Loaded rate limit state:",c))}),chrome.runtime.onMessage.addListener(function(n,e,o){"openPopup"===n.action&&(chrome.action.openPopup(),o({success:!0}))}),chrome.runtime.onInstalled.addListener(function(){console.log("LinkedIn Profile Scraper extension installed")}),chrome.runtime.onSuspend.addListener(function(){console.log("Extension is being suspended, clearing job selection"),chrome.storage.sync.remove(["selectedJobOpening"],function(){console.log("Job selection cleared on extension suspend")})}),chrome.management.onDisabled.addListener(function(n){n.id===chrome.runtime.id&&(console.log("Extension is being disabled, clearing job selection"),chrome.storage.sync.remove(["selectedJobOpening"],function(){console.log("Job selection cleared on extension disable")}))}),chrome.runtime.onMessage.addListener(function(n,e,o){if("scrapeProfile"===n.action){var t=(h=Date.now(),w=3e5,i()?{allowed:!1,reason:"cooldown",cooldownEnd:c.cooldownEnd}:(h-c.windowStart>=w&&(c.profileCount=0,c.windowStart=h,a()),c.profileCount>=r?(c.isCooldown=!0,c.cooldownEnd=h+3e5,a(),{allowed:!1,reason:"limit_reached",cooldownEnd:c.cooldownEnd}):{allowed:!0,remaining:r-c.profileCount,windowReset:c.windowStart+w}));if(!t.allowed){if("cooldown"===t.reason){var s=Math.ceil((t.cooldownEnd-Date.now())/1e3);o({success:!1,error:"Rate limit exceeded. Please wait ".concat(s," seconds before scraping again."),rateLimit:{status:"cooldown",cooldownRemaining:s,cooldownEnd:t.cooldownEnd}})}else if("limit_reached"===t.reason){var l=Math.ceil((t.cooldownEnd-Date.now())/1e3);o({success:!1,error:"Rate limit reached (".concat(r," profiles in ").concat(5," minutes). Please wait ").concat(l," seconds before scraping again."),rateLimit:{status:"cooldown",cooldownRemaining:l,cooldownEnd:t.cooldownEnd}})}return!0}return chrome.tabs.query({active:!0,currentWindow:!0},function(e){console.log("Background: Found tabs:",e.length),e[0]?(console.log("Background: Sending message to tab:",e[0].id,"URL:",e[0].url),chrome.tabs.sendMessage(e[0].id,n,function(n){console.log("Background: Received response:",n),chrome.runtime.lastError?(console.error("Background: Error communicating with content script:",chrome.runtime.lastError),o({success:!1,error:"Content script not available. Please refresh the LinkedIn page."})):(n&&n.success&&(c.profileCount++,a(),console.log("Profile count incremented: ".concat(c.profileCount,"/").concat(r))),o(n))})):(console.log("Background: No active tab found"),o({success:!1,error:"No active tab found"}))}),!0}var h,w;if("getRateLimitStatus"===n.action){var g=function(){var n=Date.now(),e=3e5;if(i())return{status:"cooldown",cooldownRemaining:Math.ceil((c.cooldownEnd-n)/1e3),cooldownEnd:c.cooldownEnd};n-c.windowStart>=e&&(c.profileCount=0,c.windowStart=n,a());var o=c.windowStart+e,t=Math.max(0,Math.ceil((o-n)/1e3));return{status:"active",profileCount:c.profileCount,maxProfiles:r,remaining:r-c.profileCount,windowRemaining:t,windowReset:o}}();return o({success:!0,data:g}),!0}return"sendToAPI"===n.action?(function(n,e){return f.apply(this,arguments)}(n.data,n.apiUrl).then(function(n){return o({success:!0,response:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):"fetchOrganizations"===n.action?(function(){return u.apply(this,arguments)}().then(function(n){return o({success:!0,data:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):"fetchJobOpenings"===n.action?(function(){return d.apply(this,arguments)}(n.organizationId).then(function(n){return o({success:!0,data:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):"sendApplicant"===n.action?(function(n){return p.apply(this,arguments)}(n.data).then(function(n){return o({success:!0,response:n})}).catch(function(n){return o({success:!1,error:n.message})}),!0):void 0});var s="https://prompthire.org/api",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjhkZjdlYjNkNDQ1NWJlNTM5ZWVhMDdiIiwidXNlcl9uYW1lIjoicGhsaW5rZWRpbiIsInVzZXJfZW1haWwiOiJzaHJleWFzaEBwcm9tcHRoaXJlLmFpIiwib3JnX2lkcyI6WyI2NzNmNjU0NzExZmJlN2U1ZWQxZjM5MmUiXSwiZXhwIjoxNzYwNzczNDUyfQ.lCZEYRd0BNdLz8d96vwJHf7ZLEAUbAdSt6XOMgPGTnY";function u(){return(u=t(n().m(function e(){var o,t,r,c;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,console.log("Fetching organizations from:","".concat(s,"/organisations?page_size=100")),n.n=1,fetch("".concat(s,"/organisations?page_size=100"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)}});case 1:if(o=n.v,console.log("Organizations response status:",o.status),o.ok){n.n=3;break}return n.n=2,o.text();case 2:throw t=n.v,console.error("Organizations API error:",t),new Error("Failed to fetch organizations: ".concat(o.status," ").concat(o.statusText," - ").concat(t));case 3:return n.n=4,o.json();case 4:return r=n.v,console.log("Organizations result:",r),n.a(2,r);case 5:throw n.p=5,c=n.v,console.error("Fetch organizations error:",c),c;case 6:return n.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function d(){return d=t(n().m(function e(){var o,t,r,c,a,i,u=arguments;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:if(o=u.length>0&&void 0!==u[0]?u[0]:null,n.p=1,o){n.n=2;break}throw new Error("Organization ID is required to fetch job openings");case 2:return t="".concat(s,"/jobopening_summary?org_id=").concat(o),console.log("Fetching job openings from:",t),n.n=3,fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)}});case 3:if(r=n.v,console.log("Job openings response status:",r.status),r.ok){n.n=5;break}return n.n=4,r.text();case 4:throw c=n.v,console.error("Job openings API error:",c),new Error("Failed to fetch job openings: ".concat(r.status," ").concat(r.statusText," - ").concat(c));case 5:return n.n=6,r.json();case 6:return a=n.v,console.log("Job openings result:",a),n.a(2,a);case 7:throw n.p=7,i=n.v,console.error("Fetch job openings error:",i),i;case 8:return n.a(2)}},e,null,[[1,7]])})),d.apply(this,arguments)}function p(){return(p=t(n().m(function e(o){var t,r,c,a;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,console.log("Sending applicant to:","".concat(s,"/applicants")),console.log("Applicant data:",o),n.n=1,fetch("".concat(s,"/applicants"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify(o)});case 1:if(t=n.v,console.log("Send applicant response status:",t.status),t.ok){n.n=3;break}return n.n=2,t.text();case 2:throw r=n.v,console.error("Send applicant API error:",r),new Error("Failed to send applicant: ".concat(t.status," ").concat(t.statusText," - ").concat(r));case 3:return n.n=4,t.json();case 4:return c=n.v,console.log("Send applicant result:",c),n.a(2,c);case 5:throw n.p=5,a=n.v,console.error("Send applicant error:",a),a;case 6:return n.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function f(){return(f=t(n().m(function e(o,t){var r,c,a;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,t){n.n=1;break}throw new Error("API URL is required");case 1:return n.n=2,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileData:o,timestamp:(new Date).toISOString(),source:"linkedin-scraper-extension"})});case 2:if((r=n.v).ok){n.n=3;break}throw new Error("API call failed with status: ".concat(r.status));case 3:return n.n=4,r.json();case 4:return c=n.v,n.a(2,c);case 5:throw n.p=5,a=n.v,console.error("API call error:",a),a;case 6:return n.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}chrome.tabs.onActivated.addListener(function(){var e=t(n().m(function e(o){var t,r;return n().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,chrome.tabs.get(o.tabId);case 1:(t=n.v).url&&(t.url.includes("linkedin.com/in/")||t.url.includes("www.linkedin.com/in/"))&&chrome.action.enable(o.tabId),n.n=3;break;case 2:n.p=2,r=n.v,console.error("Error checking tab:",r);case 3:return n.a(2)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}()),console.log("LinkedIn Profile Scraper background script loaded")})();